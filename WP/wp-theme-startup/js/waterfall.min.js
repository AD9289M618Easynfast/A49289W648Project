!function(t,e,i,a){"use strict";function o(e,i){this.$element=t(e),this.options=t.extend(!0,{},r,i),this.colHeightArray=[],this.styleQueue=[],this._init()}var s=t(e),n="waterfall",r={itemCls:"waterfall-item",prefix:"waterfall",fitWidth:!0,colWidth:300,gutterWidth:45,gutterHeight:10,align:"center",minCol:1,maxCol:a,maxPage:a,bufferPixel:-50,containerStyle:{position:"relative"},resizable:!0,isFadeIn:!1,isAnimated:!1,animationOptions:{},isAutoPrefill:!0,checkImagesLoaded:!0,path:a,dataType:"json",params:{},headers:{},loadingMsg:'<div style="text-align:center;padding:10px 0; color:#999;"><img src="data:image/gif;base64,R0lGODlhEAALAPQAAP///zMzM+Li4tra2u7u7jk5OTMzM1hYWJubm4CAgMjIyE9PT29vb6KiooODg8vLy1JSUjc3N3Jycuvr6+Dg4Pb29mBgYOPj4/X19cXFxbOzs9XV1fHx8TMzMzMzMzMzMyH5BAkLAAAAIf4aQ3JlYXRlZCB3aXRoIGFqYXhsb2FkLmluZm8AIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAALAAAFLSAgjmRpnqSgCuLKAq5AEIM4zDVw03ve27ifDgfkEYe04kDIDC5zrtYKRa2WQgAh+QQJCwAAACwAAAAAEAALAAAFJGBhGAVgnqhpHIeRvsDawqns0qeN5+y967tYLyicBYE7EYkYAgAh+QQJCwAAACwAAAAAEAALAAAFNiAgjothLOOIJAkiGgxjpGKiKMkbz7SN6zIawJcDwIK9W/HISxGBzdHTuBNOmcJVCyoUlk7CEAAh+QQJCwAAACwAAAAAEAALAAAFNSAgjqQIRRFUAo3jNGIkSdHqPI8Tz3V55zuaDacDyIQ+YrBH+hWPzJFzOQQaeavWi7oqnVIhACH5BAkLAAAALAAAAAAQAAsAAAUyICCOZGme1rJY5kRRk7hI0mJSVUXJtF3iOl7tltsBZsNfUegjAY3I5sgFY55KqdX1GgIAIfkECQsAAAAsAAAAABAACwAABTcgII5kaZ4kcV2EqLJipmnZhWGXaOOitm2aXQ4g7P2Ct2ER4AMul00kj5g0Al8tADY2y6C+4FIIACH5BAkLAAAALAAAAAAQAAsAAAUvICCOZGme5ERRk6iy7qpyHCVStA3gNa/7txxwlwv2isSacYUc+l4tADQGQ1mvpBAAIfkECQsAAAAsAAAAABAACwAABS8gII5kaZ7kRFGTqLLuqnIcJVK0DeA1r/u3HHCXC/aKxJpxhRz6Xi0ANAZDWa+kEAA7" alt=""><br />Loading...</div>',state:{isDuringAjax:!1,isProcessingData:!1,isResizing:!1,isPause:!1,curPage:1},callbacks:{loadingStart:function(t){t.show()},loadingFinished:function(t,e){e?t.remove():t.fadeOut()},loadingError:function(t){t.html("Data load faild, please try again later.")},renderData:function(e,i){var a,o;return"json"===i||"jsonp"===i?(a=t("#waterfall-tpl").html(),o=Handlebars.compile(a),o(e)):e}},debug:!1};o.prototype={constructor:o,_debug:function(){!0===this.options.debug&&("undefined"!=typeof console&&"function"==typeof console.log?1===Array.prototype.slice.call(arguments).length&&"string"==typeof Array.prototype.slice.call(arguments)[0]?console.log(Array.prototype.slice.call(arguments).toString()):console.log(Array.prototype.slice.call(arguments)):Function.prototype.bind||"undefined"==typeof console||"object"!=typeof console.log||Function.prototype.call.call(console.log,console,Array.prototype.slice.call(arguments)))},_init:function(t){var e=this.options,i=e.path;return this._setColumns(),this._initContainer(),this._resetColumnsHeightArray(),this.reLayout(t),i?(e.isAutoPrefill&&this._prefill(),e.resizable&&this._doResize(),void 0):(this._debug("Invalid path"),void 0)},_initContainer:function(){var e=this.options,i=e.prefix;t("body").css({overflow:"scroll"}),this.$element.css(this.options.containerStyle).addClass(i+"-container"),this.$element.after('<div id="'+i+'-loading">'+e.loadingMsg+'</div><div id="'+i+'-message" style="text-align:center;color:#999;"></div>'),this.$loading=t("#"+i+"-loading"),this.$message=t("#"+i+"-message")},_getColumns:function(){var t=this.options,e=t.fitWidth?this.$element.parent():this.$element,i="BODY"===e[0].tagName?e.width()-20:e.width(),a=t.colWidth,o=t.gutterWidth,s=t.minCol,n=t.maxCol,r=Math.floor(i/(a+o)),l=Math.max(r,s);return n?l>n?n:l:l},_setColumns:function(){this.cols=this._getColumns()},_getItems:function(t){var e=t.filter("."+this.options.itemCls).css({position:"absolute"});return e},_resetColumnsHeightArray:function(){var t,e=this.cols;for(this.colHeightArray.length=e,t=0;e>t;t++)this.colHeightArray[t]=0},layout:function(t,e){var i,a,o,s,n,r,l=this.options,d=this.options.isFadeIn?this._getItems(t).css({opacity:0}).animate({opacity:1}):this._getItems(t),c=this.options.isAnimated&&this.options.state.isResizing?"animate":"css",g=l.animationOptions,u=l.colWidth,h=l.gutterWidth,p=this.colHeightArray.length,m=l.align;for(this.$element.append(d),"center"===m?(i=(this.$element.width()-u*p-h*(p-1))/2,i=i>0?i:0):"left"===m?i=0:"right"===m&&(i=this.$element.width()-u*p-h*(p-1)),o=0,n=d.length;n>o;o++)this._placeItems(d[o],i);for(s=0,r=this.styleQueue.length;r>s;s++)a=this.styleQueue[s],a.$el[c](a.style,g);this.$element.height(Math.max.apply({},this.colHeightArray)),this.styleQueue=[],this.options.state.isResizing=!1,this.options.state.isProcessingData=!1,e&&e.call(d)},reLayout:function(t){var e=this.$element.find("."+this.options.itemCls);this._resetColumnsHeightArray(),this.layout(e,t)},_placeItems:function(e,i){var a,o,s=t(e),n=this.options,r=n.colWidth,l=n.gutterWidth,d=n.gutterHeight,c=this.colHeightArray,g=c.length,u=Math.min.apply({},c),h=t.inArray(u,c);a=s.hasClass(n.prefix+"-item-fixed-left")?0:s.hasClass(n.prefix+"-item-fixed-right")?g>1?g-1:0:h,o={left:(r+l)*a+i,top:c[a]},this.styleQueue.push({$el:s,style:o}),c[a]+=s.outerHeight()+d},prepend:function(t,e){this.$element.prepend(t),this.reLayout(e)},append:function(t,e){this.$element.append(t),this.reLayout(e)},removeItems:function(t,e){this.$element.find(t).remove(),this.reLayout(e)},option:function(e,i){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e),"function"==typeof i&&i(),this._init())},pause:function(t){this.options.state.isPause=!0,"function"==typeof t&&t()},resume:function(t){this.options.state.isPause=!1,"function"==typeof t&&t()},_requestData:function(e){var i,o=this,s=this.options,n=s.maxPage,r=s.state.curPage++,l=s.path,d=s.dataType,c=s.params,g=s.headers;return n!==a&&r>n?(s.state.isBeyondMaxPage=!0,s.callbacks.loadingFinished(this.$loading,s.state.isBeyondMaxPage),void 0):(i="function"==typeof l?l(r):l.join(r),this._debug("heading into ajax",i+t.param(c)),s.callbacks.loadingStart(this.$loading),s.state.isDuringAjax=!0,s.state.isProcessingData=!0,t.ajax({url:i,data:c,headers:g,dataType:d,success:function(t){o._handleResponse(t,e),o.options.state.isDuringAjax=!1},error:function(){o._responeseError("error")}}),void 0)},_handleResponse:function(e,i){var a=this,o=this.options,s=t.trim(o.callbacks.renderData(e,o.dataType)),n=t(s),r=o.checkImagesLoaded;r?n.imagesLoaded(function(){a.append(n,i),a.options.callbacks.loadingFinished(a.$loading,a.options.state.isBeyondMaxPage)}):(a.append(n,i),a.options.callbacks.loadingFinished(a.$loading,a.options.state.isBeyondMaxPage))},_responeseError:function(t){this.$loading.hide(),this.options.callbacks.loadingError(this.$message,t),"end"!==t&&"error"!==t&&(t="unknown"),this._debug("Error",t)},_nearbottom:function(){var t=this.options,e=Math.min.apply({},this.colHeightArray),i=s.scrollTop()+s.height()-this.$element.offset().top-e;return this._debug("math:",i),i>t.bufferPixel},_prefill:function(){this.$element.height()<=s.height()&&this._scroll()},_scroll:function(){var t=this.options,e=t.state;e.isProcessingData||e.isDuringAjax||e.isInvalidPage||e.isPause||this._nearbottom()&&this._requestData()},_doScroll:function(){var t,e=this;s.bind("scroll",function(){t&&clearTimeout(t),t=setTimeout(function(){e._scroll()},100)})},_resize:function(){var t=this.cols,e=this._getColumns();(e!==t||"left"!==this.options.align)&&(this.options.state.isResizing=!0,this.cols=e,this.reLayout(),this._prefill())},_doResize:function(){var t,e=this;s.bind("resize",function(){t&&clearTimeout(t),t=setTimeout(function(){e._resize()},100)})}},t.fn[n]=function(e){if("string"==typeof e){var i=Array.prototype.slice.call(arguments,1);this.each(function(){var a=t.data(this,"plugin_"+n);return a?t.isFunction(a[e])&&"_"!==e.charAt(0)?(a[e].apply(a,i),void 0):(a._debug('no such method "'+e+'"'),void 0):(a._debug("instance is not initialization"),void 0)})}else this.each(function(){t.data(this,"plugin_"+n)||t.data(this,"plugin_"+n,new o(this,e))});return this}}(jQuery,window,document),function(t,e){"use strict";var i="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";t.fn.imagesLoaded=function(a){function o(){var e=t(u),i=t(h);l&&(h.length?l.reject(c,e,i):l.resolve(c)),t.isFunction(a)&&a.call(r,c,e,i)}function s(t){n(t.target,"error"===t.type)}function n(e,a){e.src!==i&&-1===t.inArray(e,g)&&(g.push(e),a?h.push(e):u.push(e),t.data(e,"imagesLoaded",{isBroken:a,src:e.src}),d&&l.notifyWith(t(e),[a,c,t(u),t(h)]),c.length===g.length&&(setTimeout(o),c.unbind(".imagesLoaded",s)))}var r=this,l=t.isFunction(t.Deferred)?t.Deferred():0,d=t.isFunction(l.notify),c=r.find("img").add(r.filter("img")),g=[],u=[],h=[];return t.isPlainObject(a)&&t.each(a,function(t,e){"callback"===t?a=e:l&&l[t](e)}),c.length?c.bind("load.imagesLoaded error.imagesLoaded",s).each(function(a,o){var s=o.src,r=t.data(o,"imagesLoaded");return r&&r.src===s?(n(o,r.isBroken),void 0):o.complete&&o.naturalWidth!==e?(n(o,0===o.naturalWidth||0===o.naturalHeight),void 0):((o.readyState||o.complete)&&(o.src=i,o.src=s),void 0)}):o(),l?l.promise(r):r}}(jQuery);